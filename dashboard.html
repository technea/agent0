<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Agent - Live Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"
        type="application/javascript"></script>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: rgba(22, 27, 34, 0.8);
            --accent-color: #58a6ff;
            --success-color: #238636;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --border-color: #30363d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 1000px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        h1 {
            margin: 0;
            font-size: 24px;
            background: linear-gradient(90deg, #58a6ff, #bc8cff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            background: rgba(35, 134, 54, 0.2);
            color: #3fb950;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background-color: #3fb950;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(63, 185, 80, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(63, 185, 80, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(63, 185, 80, 0);
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .token-list {
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .list-header {
            padding: 15px 25px;
            background: rgba(48, 54, 61, 0.3);
            border-bottom: 1px solid var(--border-color);
            font-weight: bold;
            color: var(--text-secondary);
        }

        .token-item {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: grid;
            grid-template-columns: 1fr 1fr 1.5fr 1fr;
            align-items: center;
            transition: background 0.2s;
        }

        .token-item:hover {
            background: rgba(48, 54, 61, 0.1);
        }

        .token-item:last-child {
            border-bottom: none;
        }

        .token-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .token-symbol {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .token-timestamp {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .token-link {
            text-decoration: none;
            color: var(--accent-color);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .token-link:hover {
            text-decoration: underline;
        }

        .reputation-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            padding: 3px 8px;
            border-radius: 4px;
            color: #000;
            font-weight: bold;
            font-size: 12px;
        }

        #empty-state {
            padding: 50px;
            text-align: center;
            color: var(--text-secondary);
        }

        .footer {
            margin-top: 50px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div>
                <h1>OpenClaw Dashboard</h1>
                <p style="margin: 5px 0 0; font-size: 14px; color: var(--text-secondary);">Autonomous Agent0 / ERC-8004
                    Operator</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button id="connect-wallet" onclick="connectWallet()"
                    style="padding: 6px 15px; background: transparent; border: 1px solid var(--accent-color); color: var(--accent-color); border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 13px;">Connect
                    Wallet</button>
                <div class="status-badge">
                    <div class="status-dot"></div>
                    Agent Live
                </div>
            </div>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="total-deployments">0</div>
                <div class="stat-label">Total Tokens</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="reputation-score">0</div>
                <div class="stat-label">Reputation Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="user-address"
                    style="font-size: 14px; overflow: hidden; text-overflow: ellipsis;">No Wallet</div>
                <div class="stat-label">Your Wallet</div>
            </div>
        </div>

        <!-- Command Center -->
        <div class="token-list" style="margin-bottom: 30px; padding: 25px; background: rgba(88, 166, 255, 0.05);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: var(--accent-color);">ðŸŽ® Agent Command Center</h3>
                <span id="deployment-mode" style="font-size: 12px; color: var(--text-secondary);">Mode: Agent
                    Autonomous</span>
            </div>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end;">
                <div style="flex: 1; min-width: 200px;">
                    <label
                        style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-secondary);">Custom
                        Token Name</label>
                    <input type="text" id="custom-name" placeholder="e.g. SatoshiToken"
                        style="width: 100%; padding: 10px; background: #0d1117; border: 1px solid var(--border-color); color: white; border-radius: 6px;">
                </div>
                <div style="width: 120px;">
                    <label
                        style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-secondary);">Symbol</label>
                    <input type="text" id="custom-symbol" placeholder="SAT"
                        style="width: 100%; padding: 10px; background: #0d1117; border: 1px solid var(--border-color); color: white; border-radius: 6px;">
                </div>
                <button onclick="agentDesignToken()"
                    style="padding: 10px; background: rgba(88,166,255,0.1); border: 1px dashed var(--accent-color); color: var(--accent-color); border-radius: 6px; cursor: pointer; font-size: 12px;">ðŸª„
                    Agent Suggest</button>
                <button id="deploy-btn" onclick="handleDeploy()"
                    style="padding: 10px 20px; background: var(--success-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">ðŸš€
                    Deploy Token</button>
            </div>

            <div style="margin-top: 20px;">
                <label style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-secondary);">Custom
                    Farcaster Post</label>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <textarea id="custom-message" placeholder="What should the agent say on Farcaster?"
                        style="width: 100%; padding: 10px; background: #0d1117; border: 1px solid var(--border-color); color: white; border-radius: 6px; resize: none; height: 60px;"></textarea>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="image-url" placeholder="Image URL (optional)"
                            style="flex: 1; padding: 10px; background: #0d1117; border: 1px solid var(--border-color); color: white; border-radius: 6px;">
                        <button onclick="sendCommand('post')"
                            style="padding: 10px 20px; background: var(--accent-color); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">ðŸ“¢
                            Manual Cast</button>
                    </div>
                </div>
            </div>

            <p id="command-status" style="margin: 10px 0 0; font-size: 12px; color: #3fb950; display: none;">âœ… Command
                Sent!</p>
        </div>

        <div class="token-list">
            <div class="list-header">Deployment History</div>
            <div id="deployment-history">
                <div id="empty-state">No deployments found. Starting cycle...</div>
            </div>
        </div>

        <div class="footer">
            Powered by Agent0 SDK & ERC-8004 Standard â€¢ Base Sepolia Network
        </div>
    </div>

    <script>
        let userAddress = null;
        let provider = null;
        let signer = null;

        const ERC20_ABI = [
            "constructor(string name, string symbol, uint256 initialSupply)",
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function totalSupply() view returns (uint256)",
            "function balanceOf(address) view returns (uint256)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "event Transfer(address indexed from, address indexed to, uint256 value)"
        ];

        const ERC20_BYTECODE = "0x60806040523480156200001157600080fd5b5060405162000e9638038062000e968339818101604052810190620000379190620002e4565b82600390816200004891906200058a565b5081600490816200005a91906200058a565b508060058190555080600080620000766200012960201b60201c565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508073ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516200011591906200067c565b60405180910390a3505050620006b9565b600033905090565b6000604051905090565b600080fd";

        function agentDesignToken() {
            const prefixes = ["Open", "Base", "Claw", "Auto", "Chain", "Mesh", "Cyber", "Meta", "Hyper", "Ultra", "Mega", "Nova", "Apex", "Quantum", "Nexus"];
            const suffixes = ["Token", "Coin", "Cash", "Finance", "Pay", "Network", "Protocol", "Chain", "Swap", "Vault", "DAO", "Labs"];

            const name = prefixes[Math.floor(Math.random() * prefixes.length)] + suffixes[Math.floor(Math.random() * suffixes.length)];
            const symbol = (name[0] + name[name.length - 2] + name[name.length - 1]).toUpperCase();

            document.getElementById('custom-name').value = name;
            document.getElementById('custom-symbol').value = symbol;

            const status = document.getElementById('command-status');
            status.textContent = "ðŸª„ Agent suggested: " + name;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 3000);
        }

        async function connectWallet() {
            console.log("Connect Wallet clicked");
            if (typeof window.ethereum !== 'undefined') {
                try {
                    console.log("Ethereum provider found, requesting accounts...");
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    const accounts = await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    userAddress = accounts[0];
                    console.log("Connected address:", userAddress);

                    document.getElementById('user-address').textContent = userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                    document.getElementById('connect-wallet').textContent = 'Connected';
                    document.getElementById('connect-wallet').style.background = 'var(--success-color)';
                    document.getElementById('deployment-mode').textContent = 'Mode: User Manual (connected)';
                } catch (error) {
                    console.error("Connection error:", error);
                    alert("Connection failed: " + error.message);
                }
            } else {
                console.warn("MetaMask not found");
                alert("Please install MetaMask or a Web3 wallet extension!");
            }
        }

        async function handleDeploy() {
            if (userAddress && signer) {
                await deployFromUserWallet();
            } else {
                await sendCommand('deploy');
            }
        }

        async function deployFromUserWallet() {
            const name = document.getElementById('custom-name').value || "UserToken";
            const symbol = document.getElementById('custom-symbol').value || "UTK";
            const status = document.getElementById('command-status');
            const btn = document.getElementById('deploy-btn');

            if (!name || !symbol) {
                alert("Please provide name and symbol");
                return;
            }

            try {
                btn.disabled = true;
                btn.textContent = "âŒ› Deploying...";

                const factory = new ethers.ContractFactory(ERC20_ABI, ERC20_BYTECODE, signer);
                const initialSupply = ethers.utils.parseEther("1000000");
                const contract = await factory.deploy(name, symbol, initialSupply);

                status.textContent = "â³ Waiting for Confirmation...";
                status.style.display = 'block';

                await contract.deployed();

                status.textContent = "âœ… " + name + " Deployed at " + contract.address;
                setTimeout(() => {
                    status.style.display = 'none';
                    status.textContent = "âœ… Command Sent!";
                }, 10000);

                document.getElementById('custom-name').value = '';
                document.getElementById('custom-symbol').value = '';
            } catch (error) {
                console.error("Deployment failed", error);
                alert("Deployment failed: " + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = "ðŸš€ Deploy Token";
            }
        }

        async function sendCommand(type) {
            const name = document.getElementById('custom-name').value;
            const symbol = document.getElementById('custom-symbol').value;
            const text = document.getElementById('custom-message').value;
            const image_url = document.getElementById('image-url').value;
            const status = document.getElementById('command-status');

            try {
                const response = await fetch('/api/command', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: type,
                        params: { name, symbol, text, image_url }
                    })
                });

                if (response.ok) {
                    status.style.display = 'block';
                    setTimeout(() => status.style.display = 'none', 3000);
                    if (type === 'deploy') {
                        document.getElementById('custom-name').value = '';
                        document.getElementById('custom-symbol').value = '';
                    } else if (type === 'post') {
                        document.getElementById('custom-message').value = '';
                        document.getElementById('image-url').value = '';
                    }
                }
            } catch (e) {
                console.error('Command failed', e);
            }
        }

        async function updateDashboard() {
            try {
                const depResponse = await fetch('deployments.json');
                const deployments = await depResponse.json();

                let metadata = { agent_id: '...', reputation: 0 };
                try {
                    const metaResponse = await fetch('agent0_metadata.json');
                    metadata = await metaResponse.json();
                } catch (e) { }

                document.getElementById('total-deployments').textContent = deployments.length;
                document.getElementById('reputation-score').textContent = deployments.length;

                const historyEl = document.getElementById('deployment-history');
                if (deployments.length > 0) {
                    historyEl.innerHTML = '';
                    [...deployments].reverse().forEach(dep => {
                        const date = new Date(dep.timestamp).toLocaleString();
                        const row = document.createElement('div');
                        row.className = 'token-item';
                        row.innerHTML = `
                            <div>
                                <div class="token-name">${dep.token_name || dep.name}</div>
                                <div class="token-symbol">$${dep.token_symbol || dep.symbol}</div>
                            </div>
                            <div class="token-timestamp">${date}</div>
                            <div>
                                <span class="reputation-badge">Verified Proof</span>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">Tx: ${dep.transaction_hash.substring(0, 10)}...</div>
                            </div>
                            <div>
                                <a href="${dep.explorer_url || ('https://basescan.org/tx/' + dep.transaction_hash)}" target="_blank" class="token-link">View Explorer â†—</a>
                            </div>
                        `;
                        historyEl.appendChild(row);
                    });
                }
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        updateDashboard();
        setInterval(updateDashboard, 5000);
    </script>
</body>

</html>